{% extends "base.html" %}

{% block title %}AO3 Tracker â€“ Downloader{% endblock %}

{% block content %}
<div class="downloader-container">
    <h1>AO3 Downloader</h1>
    
    {% if error %}
    <div class="alert alert-error">
        <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}
    
    <p class="intro-text">Download fanfiction from Archive of Our Own in bulk. All actions run in the background - you can check job status below.</p>

    <!-- Recent Jobs -->
    {% if recent_jobs %}
    <div class="jobs-section">
        <h2>Recent Jobs</h2>
        <div class="table-container">
            <table class="jobs-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for job in recent_jobs %}
                    <tr>
                        <td>{{ job.id }}</td>
                        <td><code>{{ job.job_type }}</code></td>
                        <td>
                            <span class="status-badge status-{{ job.status }}">
                                {{ job.status }}
                            </span>
                        </td>
                        <td>{{ job.created_at }}</td>
                        <td><a href="/downloader/job/{{ job.id }}" class="btn-link">View</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Action Forms -->
    <div class="actions-grid">
        
        <!-- Download from AO3 Link -->
        <div class="action-card">
            <h2>1. Download from AO3 Link</h2>
            <p class="action-description">Download works from a single AO3 URL (work, series, or search page).</p>
            <form method="post" action="/downloader/download-from-link" class="action-form">
                <div class="form-group">
                    <label for="link">AO3 URL:</label>
                    <input type="url" id="link" name="link" required 
                           placeholder="https://archiveofourown.org/works/12345678"
                           class="form-input">
                </div>
                <div class="form-group">
                    <label>File Types:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="EPUB" checked> EPUB</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="MOBI"> MOBI</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="PDF"> PDF</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="HTML"> HTML</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="AZW3"> AZW3</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="pages">Page Limit (0 for all):</label>
                    <input type="number" id="pages" name="pages" min="0" value="0" class="form-input form-input-small">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="include_series"> Include series</label>
                        <label class="checkbox-label"><input type="checkbox" name="download_images"> Download images</label>
                        <label class="checkbox-label"><input type="checkbox" name="login"> Login to AO3</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">
                    Start Download
                </button>
            </form>
        </div>

        <!-- Get Links Only -->
        <div class="action-card">
            <h2>2. Get Links Only</h2>
            <p class="action-description">Extract work links from an AO3 page without downloading.</p>
            <form method="post" action="/downloader/get-links" class="action-form">
                <div class="form-group">
                    <label for="link2">AO3 URL:</label>
                    <input type="url" id="link2" name="link" required 
                           placeholder="https://archiveofourown.org/works/12345678"
                           class="form-input">
                </div>
                <div class="form-group">
                    <label for="pages2">Page Limit (0 for all):</label>
                    <input type="number" id="pages2" name="pages" min="0" value="0" class="form-input form-input-small">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="include_series"> Include series</label>
                        <label class="checkbox-label"><input type="checkbox" name="include_metadata"> Include metadata (CSV format)</label>
                        <label class="checkbox-label"><input type="checkbox" name="login"> Login to AO3</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">
                    Get Links
                </button>
            </form>
        </div>

        <!-- Download from File -->
        <div class="action-card">
            <h2>3. Download from File</h2>
            <p class="action-description">Download multiple works from a list of links (one per line).</p>
            <form method="post" action="/downloader/download-from-file" class="action-form">
                <div class="form-group">
                    <label for="file_content">Links (one per line):</label>
                    <textarea id="file_content" name="file_content" rows="10" required
                              placeholder="https://archiveofourown.org/works/12345678&#10;https://archiveofourown.org/works/87654321"
                              class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label>File Types:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="EPUB" checked> EPUB</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="MOBI"> MOBI</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="PDF"> PDF</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="HTML"> HTML</label>
                        <label class="checkbox-label"><input type="checkbox" name="file_types" value="AZW3"> AZW3</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="include_series" checked> Include series</label>
                        <label class="checkbox-label"><input type="checkbox" name="download_images"> Download images</label>
                        <label class="checkbox-label"><input type="checkbox" name="login"> Login to AO3</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-info">
                    Start Download
                </button>
            </form>
        </div>

    </div>

    <!-- Settings Section -->
    <div class="settings-section">
        <h3>Settings</h3>
        <p>Download folder: <code>{{ settings.download_folder }}</code></p>
        <p><a href="/api/v1/downloader/settings" class="btn-link">View/Edit Settings (API)</a></p>
    </div>

</div>

{% endblock %}

